// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(cuid())
  email        String         @unique
  name         String?
  passwordHash String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  qrcodes      QRCode[]
  leadTemplates LeadTemplate[]
  templateAssets TemplateAsset[]
  folders      Folder[]
  campaigns    Campaign[]
  scheduledReports ScheduledReport[]
}

model QRCode {
  id          String      @id @default(cuid())
  ownerId     String
  owner       User        @relation(fields: [ownerId], references: [id])
  label       String
  slug        String      @unique
  destination String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  scans       ScanEvent[]
  leads       Lead[]
  // QR Content Type and Data
  contentType   String     @default("url") // "url", "vcard", "wifi", "event", "sms", "email", "whatsapp", "phone", "text"
  contentData   Json       @default("{}")  // Structured data for each content type
  // Metadata fields
  metaTitle       String?
  metaDescription String?
  metaImage       String?
  // Style fields (per-QR)
  logoUrl       String?
  fgColor       String?   @default("#000000")
  bgColor       String?   @default("#ffffff")
  styleType     String?   @default("square")
  logoAspect    String?   @default("1:1")
  cornerRadius  Int?      @default(8)
  logoSizePct   Int?      @default(24)
  // Lead collection
  collectLeads  Boolean   @default(false)
  leadTemplateId String?
  leadTemplate   LeadTemplate? @relation(fields: [leadTemplateId], references: [id])
  // Folder organization
  folderId      String?
  folder        Folder?   @relation(fields: [folderId], references: [id])
  // A/B Testing
  isTestVariant Boolean   @default(false)
  parentQrId    String?
  parentQr      QRCode?   @relation("QRVariants", fields: [parentQrId], references: [id])
  variants      QRCode[]  @relation("QRVariants")
}

model ScanEvent {
  id         String   @id @default(cuid())
  qrId       String
  qr         QRCode   @relation(fields: [qrId], references: [id])
  createdAt  DateTime @default(now())
  ip         String?
  userAgent  String?
  referer    String?
  country    String?
  city       String?
  // Enhanced analytics
  deviceType String?  // "mobile", "tablet", "desktop"
  browser    String?  // "chrome", "safari", "firefox", etc.
  os         String?  // "ios", "android", "windows", etc.
  latitude   Float?
  longitude  Float?
  // Conversion tracking
  sessionId  String?  // Track user sessions
  converted  Boolean  @default(false) // Did user complete desired action
  conversionValue Float? // Value of conversion (optional)
}

model Lead {
  id         String   @id @default(cuid())
  qrId       String
  qr         QRCode   @relation(fields: [qrId], references: [id])
  createdAt  DateTime @default(now())
  name       String?
  email      String?
  phone      String?
  company    String?
  message    String?
  ip         String?
  userAgent  String?
  // Custom form data as JSON for enhanced templates
  formData   Json?    @default("{}")
}

model LeadTemplate {
  id          String   @id @default(cuid())
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id])
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Template Design
  title       String   @default("Get Exclusive Access")
  subtitle    String?
  logoUrl     String?
  bannerUrl   String?
  bannerPosition String @default("top") // "top", "bottom", "none"
  
  // Styling
  backgroundColor String @default("#f8fafc")
  cardColor      String @default("#ffffff")
  primaryColor   String @default("#3b82f6")
  textColor      String @default("#1f2937")
  buttonColor    String @default("#3b82f6")
  buttonTextColor String @default("#ffffff")
  
  // Button & Footer
  buttonText     String @default("Submit")
  footerText     String @default("Your information is secure and will not be shared with third parties.")
  
  // Social Media Links
  facebookUrl    String?
  twitterUrl     String?
  instagramUrl   String?
  linkedinUrl    String?
  youtubeUrl     String?
  tiktokUrl      String?
  websiteUrl     String?
  
  // Legal Links
  termsUrl       String?
  privacyUrl     String?
  
  // Custom Form Fields (JSON)
  formFields     Json   @default("[]")
  
  // QR Codes using this template
  qrcodes        QRCode[]
}

model TemplateAsset {
  id          String   @id @default(cuid())
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id])
  filename    String
  originalName String
  mimeType    String
  size        Int
  url         String
  assetType   String   // "logo", "banner", "icon"
  createdAt   DateTime @default(now())
}

model Folder {
  id          String   @id @default(cuid())
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id])
  name        String
  description String?
  icon        String   @default("üìÅ") // Emoji icon
  color       String   @default("#3b82f6") // Hex color
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relationships
  qrcodes     QRCode[]
}

model Campaign {
  id          String   @id @default(cuid())
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id])
  name        String
  description String?
  startDate   DateTime?
  endDate     DateTime?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relationships
  qrcodes     QRCode[]
}

model ScheduledReport {
  id          String   @id @default(cuid())
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id])
  name        String
  frequency   String   // "daily", "weekly", "monthly"
  emailTo     String[]
  reportType  String   // "analytics", "leads", "combined"
  filters     Json     @default("{}")
  lastSent    DateTime?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
